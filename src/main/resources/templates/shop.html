<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head}">
</head>

<body>
<!-- Start Header/Navigation -->
<header th:replace="~{fragments/header :: navigation('shop')}"></header>
<!-- End Header/Navigation -->

<!-- Start Hero Section -->
<div class="hero gradient-custom">
  <div class="container">
    <div class="row justify-content-between">
      <div class="col-lg-5">
        <div class="intro-excerpt">
          <h1 class="extra-bold-text">Shop</h1>
          <p class="mb-4">HealthShop만의 최고의 헬스용품으로 당신의 운동 목표를 달성하세요!<br>
            고품질 피트니스 용품으로 집에서도 체육관 수준의 운동을 경험할 수 있습니다.<br>
            건강한 라이프스타일을 위한 완벽한 파트너를 지금 바로 만나보세요!</p>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- End Hero Section -->

<!-- Start Product Section -->
<div class="untree_co-section product-section before-footer-section">
  <div class="container">
    <!-- 상품 정렬 및 검색 -->
    <div class="row mb-5 justify-content-center">
      <div class="col-md-9">
        <div class="row">
          <div class="col-md-2 d-flex align-items-center">
            <div class="dropdown w-100">
              <button class="btn btn-secondary dropdown-toggle w-100" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <span id="sortDropdownText">정렬</span>
              </button>
              <ul class="dropdown-menu" aria-labelledby="sortDropdown">
                <li><a class="dropdown-item" href="#" onclick="setSort('idDesc', '신상품순')">신상품순</a></li>
                <li><a class="dropdown-item" href="#" onclick="setSort('priceDesc', '높은 가격순')">높은 가격순</a></li>
                <li><a class="dropdown-item" href="#" onclick="setSort('priceAsc', '낮은 가격순')">낮은 가격순</a></li>
                <li><a class="dropdown-item" href="#" onclick="setSort('discountRateDesc', '할인율순')">할인율순</a></li>
              </ul>
              <form id="sortForm" th:action="@{/shop}" method="get" style="display:none;">
                <input type="hidden" name="sort" id="sortInput" th:value="${sort}">
              </form>
            </div>
          </div>
          <div class="col-md-10">
            <form th:action="@{/shop}" method="get" class="d-flex">
              <input type="text" name="keyword" class="form-control me-4" placeholder="Search products..." th:value="${keyword}">
              <button type="submit" class="btn btn-primary">Search</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- 상품 목록 -->
    <div class="row">

      <div th:each="item : ${items}" class="col-12 col-md-4 col-lg-3 mb-5">
        <a class="product-item" th:href="@{/shop/item/{id}(id=*{item.id})}">
          <img th:src="@{${item.imgPath}}" class="img-fluid product-thumbnail">
          <h3 class="product-title bold-text" th:text="${item.name}"></h3>
          <th:block th:if="${item.discountRate} != 0">
            <div>
              <span class="bold-text" th:text="${item.discountRate} + '%'"></span>
              <del><span class="mb-0 original-price" th:text="${#numbers.formatInteger(item.price, 3, 'COMMA')} + '원'"></span></del>
            </div>
            <strong class="product-price fs-1"
                    th:text="${#numbers.formatInteger(item.price - (item.discountRate * item.price * 0.01), 3, 'COMMA')} + '원'">
            </strong>
          </th:block>
          <th:block th:if="${item.discountRate} == 0">
            <strong class="product-price fs-1" th:text="${#numbers.formatInteger(item.price, 3, 'COMMA')} + '원'"></strong>
          </th:block>

          <span class="icon-cross">
            <img src="/images/cross.svg" class="img-fluid">
          </span>
        </a>
      </div>

    </div>

    <!-- Start Pagination -->
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item prev-btn" th:classappend="${currentPage == 0} ? 'disabled'">
          <a class="page-link" th:href="@{/shop(page=${currentPage - 1}, sort=${sort}, keyword=${keyword})}" aria-label="Previous">
            <span aria-hidden="true">Prev</span>
          </a>
        </li>

        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
            th:if="${i >= currentPage - 4 and i <= currentPage + 4}"
            th:classappend="${i == currentPage} ? 'active'">
          <a class="page-link" th:href="@{/shop(page=${i}, sort=${sort}, keyword=${keyword})}" th:text="${i + 1}">1</a>
        </li>

        <li class="page-item next-btn" th:classappend="${currentPage + 1 == totalPages} ? 'disabled'">
          <a class="page-link" th:href="@{/shop(page=${currentPage + 1}, sort=${sort}, keyword=${keyword})}" aria-label="Next">
            <span aria-hidden="true">Next</span>
          </a>
        </li>
      </ul>
    </nav>
    <!-- End Pagination -->

  </div>
</div>
<!-- End Product Section -->

<!-- Start Footer Section -->
<footer th:replace="~{fragments/footer :: footer}"></footer>
<!-- End Footer Section -->

<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/tiny-slider.js"></script>
<script src="/js/custom.js"></script>
<script>
  function setSort(value, text) {
    document.getElementById('sortInput').value = value;
    document.getElementById('sortDropdownText').innerText = text;
    document.getElementById('sortForm').submit();
  }

  // 페이지 로드할 때마다 드롭다운 텍스트 초기화
  document.addEventListener('DOMContentLoaded', function() {
    const sortValue = document.getElementById('sortInput').value;
    let sortText = '정렬';
    if (sortValue === 'idDesc') sortText = '신상품순';
    else if (sortValue === 'priceDesc') sortText = '높은 가격순';
    else if (sortValue === 'priceAsc') sortText = '낮은 가격순';
    else if (sortValue === 'discountRateDesc') sortText = '할인율순';

    document.getElementById('sortDropdownText').innerText = sortText;
  });
</script>

</body>

</html>
